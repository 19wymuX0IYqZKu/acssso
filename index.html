<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Firebase Google SSO</title>

    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 450px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a, #google-signin-btn {
        display: block;
        text-align: center;
        background: #4285F4; /* Google Blue */
        text-transform: uppercase;
        text-decoration: none;
        color: white;
        padding: 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
        border: none;
        width: 100%;
        font-size: 14px;
        font-weight: 500;
      }
      #signout-btn {
        background: #DB4437; /* Google Red */
        display: block;
        text-align: center;
        text-transform: uppercase;
        text-decoration: none;
        color: white;
        padding: 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
        border: none;
        width: 100%;
        font-size: 14px;
        font-weight: 500;
      }
      #message, #message a, #message button { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      
      /* Error Message Styling */
      #error-container {
        display: none;
        background-color: #ffebee;
        color: #c62828;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 16px;
        border: 1px solid #ffcdd2;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div id="message">
      <h2>Authentication Status</h2>
      
      <!-- Error Container -->
      <div id="error-container"></div>

      <h1 id="user-status">Firebase App Loading...</h1>
      
      <p id="user-details" style="display:none;"></p>
      
      <button id="google-signin-btn">Sign in with Google</button>
      <button id="signout-btn" style="display:none;">Sign Out</button>
      
    </div>
    <p id="load">Firebase SDK Loading&hellip;</p>

    <script type="module">
      // Import modules using Google CDN links (V9 Modular)
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import { 
        getAuth, 
        GoogleAuthProvider, 
        signInWithRedirect, 
        getRedirectResult, 
        signOut, 
        onAuthStateChanged 
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
      
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBguMl7HKPfKqrCZI77HFtZ2VEFvjRAQms",
        authDomain: "acs20251204.firebaseapp.com",
        projectId: "acs20251204",
        storageBucket: "acs20251204.firebasestorage.app",
        messagingSenderId: "1098809722952",
        appId: "1:1098809722952:web:5b63eff20e2a0cc992707d"
      };

      // Initialize Firebase App and Auth service
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const googleProvider = new GoogleAuthProvider();
      
      // --- Get DOM Elements ---
      const loadEl = document.querySelector('#load');
      const userStatusEl = document.querySelector('#user-status');
      const userDetailsEl = document.querySelector('#user-details');
      const signInBtn = document.querySelector('#google-signin-btn');
      const signOutBtn = document.querySelector('#signout-btn');
      const errorContainer = document.querySelector('#error-container');
      
      loadEl.textContent = 'Firebase SDK loaded and initializing.';

      // --- Helper: Display Error ---
      function showError(message) {
        errorContainer.textContent = message;
        errorContainer.style.display = 'block';
        console.error(message);
      }

      function clearError() {
        errorContainer.style.display = 'none';
        errorContainer.textContent = '';
      }

      // --- 1. Handle Redirect Result (Check for errors returning from Google) ---
      getRedirectResult(auth)
        .then((result) => {
          // If the user just returned from the redirect flow, result will be defined.
          // If they are just loading the page normally, it will be null.
          if (result) {
            console.log("Redirect sign-in successful for:", result.user.email);
            // No need to update UI here, onAuthStateChanged will handle it.
          }
        })
        .catch((error) => {
          showError(`Login Failed: ${error.message}`);
        });

      // --- 2. Authentication State Listener ---
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // User is signed in
          userStatusEl.textContent = `Welcome back, ${user.displayName}!`;
          userDetailsEl.innerHTML = `User ID: ${user.uid}<br>Email: ${user.email}`;
          userDetailsEl.style.display = 'block';
          
          signInBtn.style.display = 'none';
          signOutBtn.style.display = 'block';
          
          loadEl.textContent = 'User is authenticated.';
          clearError(); // Clear any previous login errors if we are now auth'd
        } else {
          // User is signed out
          userStatusEl.textContent = 'You are currently signed out.';
          userDetailsEl.style.display = 'none';
          
          signInBtn.style.display = 'block';
          signOutBtn.style.display = 'none';
          
          loadEl.textContent = 'Ready to sign in.';
        }
      });

      // --- 3. Sign-In Handler (Redirect) ---
      signInBtn.addEventListener('click', () => {
        loadEl.textContent = 'Redirecting to Google...';
        clearError();
        signInWithRedirect(auth, googleProvider);
        // Note: The page will redirect away, so no .then() is needed here usually.
        // Errors will be caught by getRedirectResult when the page reloads.
      });

      // --- 4. Sign-Out Handler ---
      signOutBtn.addEventListener('click', () => {
        signOut(auth)
          .then(() => {
            console.log("Sign-out successful.");
            // UI updates automatically via onAuthStateChanged
          })
          .catch((error) => showError(`Sign-out Error: ${error.message}`));
      });
    </script>
  </body>
</html>